<?php
/**
 * @var \Rollpix\GoogleOneTap\Block\Customer\Account\GoogleLinkedNotice $block
 * @var \Magento\Framework\Escaper $escaper
 */

use Magento\Framework\Escaper;
use Rollpix\GoogleOneTap\Block\Customer\Account\GoogleLinkedNotice;

// Only show for logged in customers
if (!$block->isCustomerLoggedIn()) {
    return;
}

// Only show for accounts linked with Google One Tap (created or linked)
if (!$block->isGoogleOneTapLinked()) {
    return;
}

$googleEmail = $escaper->escapeHtml($block->getGoogleEmail());
$isCreatedWithGoogle = $block->isGoogleOneTapCreated();
?>

<!-- Google One Tap Account Notice -->
<div class="message info google-onetap-notice" style="margin-bottom: 20px;">
    <div>
        <?= $escaper->escapeHtml(__('Your LibrerÃ­a Oxford account is linked with your Google account %1', $googleEmail)) ?>
    </div>
</div>

<?php if ($isCreatedWithGoogle): ?>
    <!-- Hide change password checkbox for Google One Tap created accounts -->
    <style>
        /* Hide change password checkbox */
        .field.choice.change-password {
            display: none !important;
        }

        /* Hide the entire password fieldset when checkbox is hidden */
        .fieldset.password {
            display: none !important;
        }
    </style>

    <script>
        require(['jquery'], function($) {
            $(document).ready(function() {
                // Double check: Hide the entire change password fieldset since account was created via Google
                $('.fieldset.password').hide();

                // Also hide any change email/password checkbox if it exists
                $('.field.choice.change-password').hide();

                // If there's a "Change Email and Password" section, hide it
                $('fieldset.fieldset.password').hide();
            });
        });
    </script>
<?php endif; ?>
